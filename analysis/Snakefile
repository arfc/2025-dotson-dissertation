import sys

latexopt = """
            -shell-escape 
            -interaction nonstopmode 
            -file-line-error 
            -halt-on-error
            """

rule targets:
    input:
        thesis = "../docs/thesis.pdf",
        dag = "dag.png"

if sys.platform == 'Windows':
    rule build_thesis:
        input: 
            main_tex = "../docs/thesis.tex"
        output: "../docs/thesis.pdf"
        shell:
            f"""
            cd ../docs && \
            pdflatex {latexopt} thesis.tex && \
            biber thesis && \
            pdflatex {latexopt} thesis.tex && \
            pdflatex {latexopt} thesis.tex &&
            """
elif sys.platform in ['darwin', 'linux']:
    rule build_thesis:
        input: 
            main_tex = "../docs/thesis.tex"
        output: "../docs/thesis.pdf"
        shell:
            """
            (cd ../docs && make)
            """

rule build_dag:
    input: "Snakefile"
    output:
        "dag.png"
    shell:
        "snakemake --dag | dot -Tpng > {output}"